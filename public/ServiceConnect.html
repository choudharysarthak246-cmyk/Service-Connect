<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ServiceConnect - OTP Login</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Base Styles & Utilities */
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .font-mono { font-family: 'Space Mono', monospace; }
        
        /* Hide Scrollbar but allow scroll */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Receipt Jagged Edge Effect */
        .receipt-jagged {
            position: relative;
        }
        .receipt-jagged::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 10px;
            background: linear-gradient(45deg, transparent 33.333%, #ffffff 33.333%, #ffffff 66.667%, transparent 66.667%), 
                        linear-gradient(-45deg, transparent 33.333%, #ffffff 33.333%, #ffffff 66.667%, transparent 66.667%);
            background-size: 20px 40px;
        }

        /* Mobile Shell Simulation for Desktop */
        #app-shell {
            max-width: 420px;
            margin: 0 auto;
            background: #ffffff;
            height: 100vh;
            position: relative;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid #e5e7eb;
        }

        /* Animations */
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in { animation: fadeIn 0.2s ease-out forwards; }
    </style>
</head>
<body>

<div id="app-shell" class="flex flex-col text-gray-800">

    <header class="h-16 bg-white border-b border-gray-100 flex items-center justify-between px-5 sticky top-0 z-20">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">S</div>
            <h1 class="font-bold text-xl tracking-tight text-indigo-900">ServiceConnect</h1>
        </div>
        <div id="header-profile" class="relative">
            <!-- Profile Icon Injected Here -->
        </div>
    </header>

    <main id="main-content" class="flex-1 overflow-y-auto no-scrollbar bg-gray-50 pb-24 relative">
        <!-- Views Injected Here -->
    </main>

    <nav id="bottom-nav" class="h-20 bg-white border-t border-gray-100 flex items-center justify-around px-2 absolute bottom-0 w-full z-20 hidden">
        <button onclick="router.navigate('home')" class="nav-btn flex flex-col items-center gap-1 p-2 text-gray-400 hover:text-indigo-600 transition-colors" data-target="home">
            <i class="fa-solid fa-house text-xl"></i>
            <span class="text-xs font-medium">Home</span>
        </button>
        <button onclick="router.navigate('bookings')" class="nav-btn flex flex-col items-center gap-1 p-2 text-gray-400 hover:text-indigo-600 transition-colors" data-target="bookings">
            <i class="fa-solid fa-calendar-check text-xl"></i>
            <span class="text-xs font-medium">Bookings</span>
        </button>
        <button onclick="router.navigate('account')" class="nav-btn flex flex-col items-center gap-1 p-2 text-gray-400 hover:text-indigo-600 transition-colors" data-target="account">
            <i class="fa-solid fa-user text-xl"></i>
            <span class="text-xs font-medium">Account</span>
        </button>
    </nav>

</div>

<!-- Global Modals -->

<div id="modal-overlay" class="fixed inset-0 bg-black/50 z-30 hidden backdrop-blur-sm transition-opacity" onclick="modals.closeAll()"></div>

<!-- Fake SMS Notification -->
<div id="fake-sms" class="fixed top-4 left-4 right-4 max-w-[400px] mx-auto bg-white/95 backdrop-blur shadow-2xl rounded-2xl p-4 z-50 transform -translate-y-[200%] transition-transform duration-500 border border-gray-100 flex items-start gap-4 cursor-pointer" onclick="this.classList.add('-translate-y-[200%]')">
    <div class="w-10 h-10 bg-green-500 rounded-full flex-shrink-0 flex items-center justify-center text-white shadow-lg shadow-green-200">
        <i class="fa-solid fa-comment-sms"></i>
    </div>
    <div class="flex-1">
        <div class="flex justify-between items-center mb-1">
            <h4 class="font-bold text-xs uppercase text-gray-500 tracking-wider">Messages • Now</h4>
        </div>
        <p class="font-medium text-sm text-gray-800 leading-tight">
            Your ServiceConnect Verification Code is: <br>
            <span id="sms-otp-code" class="text-indigo-600 font-mono font-bold text-lg tracking-widest bg-indigo-50 px-2 rounded mt-1 inline-block"></span>
        </p>
    </div>
</div>

<!-- Login Modal -->
<div id="login-modal" class="fixed bottom-0 left-0 right-0 z-40 bg-white rounded-t-3xl p-6 transform translate-y-full transition-transform duration-300 max-w-[420px] mx-auto w-full">
    <div id="login-step-mobile">
        <h2 class="text-2xl font-bold mb-2">Welcome Back</h2>
        <p class="text-gray-500 mb-6 text-sm">Enter your mobile number to continue.</p>
        <div class="space-y-4">
            <div>
                <label class="text-xs font-bold text-gray-400 uppercase">Mobile Number</label>
                <div class="flex items-center border-b-2 border-gray-200 py-3">
                    <span class="text-gray-500 text-lg mr-2">+91</span>
                    <input type="tel" id="login-mobile" placeholder="98765 43210" maxlength="10" class="flex-1 text-lg focus:outline-none focus:border-indigo-600 bg-transparent font-mono tracking-wide">
                </div>
            </div>
            <button onclick="auth.sendOTP()" id="btn-get-otp" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-indigo-200 active:scale-95 transition-transform">
                Get OTP
            </button>
        </div>
    </div>

    <div id="login-step-otp" class="hidden">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold">Enter OTP</h2>
            <button onclick="auth.resetLogin()" class="text-sm text-indigo-600 font-bold">Edit Number</button>
        </div>
        <p class="text-gray-500 mb-6 text-sm">Code sent to <span id="otp-mobile-display" class="font-bold text-gray-800 font-mono"></span></p>
        <div class="space-y-6">
            <div class="flex justify-center gap-2">
                <input type="text" id="otp-input" placeholder="• • • •" maxlength="4" class="w-full text-center text-3xl font-mono font-bold tracking-[1em] border-b-2 border-gray-200 py-3 focus:outline-none focus:border-indigo-600 bg-transparent">
            </div>
            <button onclick="auth.verifyAndLogin()" id="btn-verify-otp" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-indigo-200 active:scale-95 transition-transform">
                Verify & Login
            </button>
            <p class="text-center text-xs text-gray-400">Didn't receive it? <button onclick="auth.sendOTP()" class="text-indigo-600 font-bold">Resend</button></p>
        </div>
    </div>
</div>

<!-- Pro Signup Modal -->
<div id="pro-signup-modal" class="fixed bottom-0 left-0 right-0 z-40 bg-white rounded-t-3xl p-6 transform translate-y-full transition-transform duration-300 max-w-[420px] mx-auto w-full h-[85vh] overflow-y-auto">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">Become a Pro</h2>
        <button onclick="modals.closeAll()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center"><i class="fa-solid fa-times"></i></button>
    </div>
    
    <form id="pro-form" onsubmit="auth.submitProApplication(event)" class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="text-xs font-bold text-gray-500">First Name</label>
                <input type="text" name="fname" required class="w-full bg-gray-50 rounded-lg p-3 mt-1 focus:ring-2 ring-indigo-600 outline-none">
            </div>
            <div>
                <label class="text-xs font-bold text-gray-500">Last Name</label>
                <input type="text" name="lname" required class="w-full bg-gray-50 rounded-lg p-3 mt-1 focus:ring-2 ring-indigo-600 outline-none">
            </div>
        </div>
        
        <div>
            <label class="text-xs font-bold text-gray-500">Mobile Number</label>
            <input type="tel" name="mobile" required placeholder="9876543210" class="w-full bg-gray-50 rounded-lg p-3 mt-1 focus:ring-2 ring-indigo-600 outline-none font-mono">
        </div>

        <div>
            <label class="text-xs font-bold text-gray-500">Category</label>
            <select name="category" required class="w-full bg-gray-50 rounded-lg p-3 mt-1 focus:ring-2 ring-indigo-600 outline-none">
                <option value="Cleaning">Cleaning</option>
                <option value="Plumbing">Plumbing</option>
                <option value="Electrical">Electrical</option>
                <option value="Painting">Painting</option>
                <option value="Appliance">Appliance Repair</option>
            </select>
        </div>
        <div>
            <label class="text-xs font-bold text-gray-500">Per Service Rate (₹)</label>
            <input type="number" name="rate" required placeholder="e.g. 500" class="w-full bg-gray-50 rounded-lg p-3 mt-1 focus:ring-2 ring-indigo-600 outline-none font-mono">
        </div>
        <div>
            <label class="text-xs font-bold text-gray-500">Account Number</label>
            <input type="number" name="accountNumber" required placeholder="Enter Bank Account No." class="w-full bg-gray-50 rounded-lg p-3 mt-1 focus:ring-2 ring-indigo-600 outline-none font-mono">
        </div>
        
        <button type="submit" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold shadow-lg mt-4 flex justify-center items-center gap-2">
            <span>Send for Approval</span>
            <i class="fa-solid fa-paper-plane"></i>
        </button>
    </form>
</div>

<!-- Booking Flow Modal -->
<div id="booking-modal" class="fixed bottom-0 left-0 right-0 z-40 bg-white rounded-t-3xl p-0 transform translate-y-full transition-transform duration-300 max-w-[420px] mx-auto w-full h-[90vh] flex flex-col">
    <div class="p-5 border-b flex justify-between items-center">
        <h3 class="font-bold text-lg" id="booking-title">Book Service</h3>
        <button onclick="modals.closeAll()" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-times text-xl"></i></button>
    </div>

    <div id="booking-step-1" class="p-5 flex-1 overflow-y-auto">
        <div class="space-y-5">
            <div>
                <label class="text-sm font-semibold text-gray-600">Select Date</label>
                <input type="date" id="book-date" class="w-full mt-2 p-3 border rounded-xl bg-gray-50 font-mono text-sm">
            </div>
            <div>
                <label class="text-sm font-semibold text-gray-600">Address</label>
                <textarea id="book-address" rows="3" class="w-full mt-2 p-3 border rounded-xl bg-gray-50 text-sm" placeholder="House No, Street, Area..."></textarea>
            </div>
            <div class="bg-indigo-50 p-4 rounded-xl flex items-start gap-3">
                <i class="fa-solid fa-info-circle text-indigo-600 mt-1"></i>
                <p class="text-xs text-indigo-800 leading-relaxed">Standard safety protocols will be followed by all professionals during the visit.</p>
            </div>
        </div>
    </div>

    <div id="booking-step-2" class="p-5 flex-1 overflow-y-auto hidden">
        <h4 class="text-sm font-bold text-gray-500 mb-3 uppercase">Available Professionals</h4>
        <div id="pro-list-container" class="space-y-3">
            <!-- Pros Injected Here -->
        </div>
    </div>

    <div class="p-5 border-t bg-white">
        <button id="btn-find-pros" onclick="booking.findPros()" class="w-full bg-indigo-600 text-white py-3.5 rounded-xl font-bold shadow-lg shadow-indigo-200">
            Find Professionals
        </button>
        <div id="booking-spinner" class="hidden justify-center items-center py-2">
            <i class="fa-solid fa-circle-notch fa-spin text-indigo-600 text-2xl"></i>
        </div>
    </div>
</div>

<!-- Receipt Modal -->
<div id="receipt-modal" class="fixed inset-0 z-50 flex items-center justify-center px-4 hidden pointer-events-none">
    <div class="bg-white w-full max-w-[340px] shadow-2xl pointer-events-auto transform transition-all scale-95 opacity-0 duration-200 receipt-jagged rounded-t-lg" id="receipt-card">
        <div class="p-6 text-center border-b border-dashed border-gray-300">
            <div class="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-3">
                <i class="fa-solid fa-check text-xl"></i>
            </div>
            <h2 class="text-xl font-bold text-gray-800">Payment Receipt</h2>
            <p class="text-xs text-gray-400 mt-1" id="receipt-id">#INV-2023001</p>
        </div>
        <div class="p-6 space-y-4">
            <div class="flex justify-between text-sm">
                <span class="text-gray-500">Service</span>
                <span class="font-bold text-gray-800" id="receipt-service">Cleaning</span>
            </div>
            <div class="flex justify-between text-sm">
                <span class="text-gray-500">Professional</span>
                <span class="font-bold text-gray-800" id="receipt-pro">Rajesh K.</span>
            </div>
            <div class="flex justify-between text-sm">
                <span class="text-gray-500">Date</span>
                <span class="font-bold text-gray-800" id="receipt-date">12 Oct</span>
            </div>
            <div class="border-t border-gray-100 my-2"></div>
            <div class="flex justify-between items-center">
                <span class="font-bold text-gray-800">Total Paid</span>
                <span class="font-bold text-2xl text-indigo-600 font-mono" id="receipt-amount">₹450</span>
            </div>
        </div>
        <div class="p-4 bg-gray-50 text-center pb-8 rounded-b-lg">
            <button onclick="modals.closeReceipt()" class="text-sm font-semibold text-indigo-600">Close Receipt</button>
        </div>
    </div>
</div>

<!-- Confirm Cancel Modal -->
<div id="confirm-modal" class="fixed inset-0 z-50 flex items-center justify-center px-6 hidden bg-black/50 backdrop-blur-sm">
    <div class="bg-white w-full max-w-[320px] rounded-2xl p-6 shadow-2xl">
        <h3 class="font-bold text-lg mb-2">Cancel Booking?</h3>
        <p class="text-sm text-gray-500 mb-6">Are you sure? This action cannot be undone.</p>
        <div class="flex gap-3">
            <button onclick="modals.closeConfirm()" class="flex-1 py-3 bg-gray-100 rounded-xl font-semibold text-gray-600">No</button>
            <button id="btn-confirm-cancel" class="flex-1 py-3 bg-red-50 text-red-600 rounded-xl font-bold flex justify-center items-center gap-2">
                Yes, Cancel
            </button>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-xl text-sm font-medium z-50 flex items-center gap-3 transition-all duration-300 opacity-0 translate-y-[-20px] pointer-events-none">
    <i id="toast-icon" class="fa-solid fa-check-circle text-green-400"></i>
    <span id="toast-msg">Action Successful</span>
</div>

<script>
    /**
     * =========================================
     * STATE MANAGEMENT & DATA
     * =========================================
     */
    
    // Initial Data Generator - Clean State
    const generateInitialData = () => {
        if (!localStorage.getItem('sc_users')) {
            localStorage.setItem('sc_users', JSON.stringify([]));
        }
        if (!localStorage.getItem('sc_pros')) {
            localStorage.setItem('sc_pros', JSON.stringify([])); 
        }
        if (!localStorage.getItem('sc_bookings')) {
            localStorage.setItem('sc_bookings', JSON.stringify([])); 
        }
        if (!localStorage.getItem('sc_pro_requests')) {
            localStorage.setItem('sc_pro_requests', JSON.stringify([]));
        }
    };

    const store = {
        user: JSON.parse(localStorage.getItem('sc_current_user')) || null,
        role: JSON.parse(localStorage.getItem('sc_current_role')) || 'customer',
        
        getPros: () => JSON.parse(localStorage.getItem('sc_pros')) || [],
        addPro: (pro) => {
            const pros = store.getPros();
            pros.push(pro);
            localStorage.setItem('sc_pros', JSON.stringify(pros));
        },

        // Logic for Pro Requests
        getProRequests: () => {
            try {
                return JSON.parse(localStorage.getItem('sc_pro_requests')) || [];
            } catch (e) {
                return [];
            }
        },
        addProRequest: (request) => {
            const requests = store.getProRequests();
            requests.push(request);
            localStorage.setItem('sc_pro_requests', JSON.stringify(requests));
        },
        removeProRequest: (id) => {
            let requests = store.getProRequests();
            requests = requests.filter(r => r.id !== id);
            localStorage.setItem('sc_pro_requests', JSON.stringify(requests));
        },
        
        getBookings: () => {
            try {
                return JSON.parse(localStorage.getItem('sc_bookings')) || [];
            } catch(e) { return []; }
        },
        addBooking: (booking) => {
            const bookings = store.getBookings();
            bookings.unshift(booking);
            localStorage.setItem('sc_bookings', JSON.stringify(bookings));
        },
        removeBooking: (id) => {
            let bookings = store.getBookings();
            bookings = bookings.filter(b => b.id !== id);
            localStorage.setItem('sc_bookings', JSON.stringify(bookings));
        },

        loginUser: (mobile) => {
            if (mobile === '7678192772') {
                const adminUser = { mobile, name: 'Super Admin', joined: new Date().toISOString() };
                localStorage.setItem('sc_current_user', JSON.stringify(adminUser));
                localStorage.setItem('sc_current_role', JSON.stringify('admin'));
                store.user = adminUser;
                store.role = 'admin';
                return;
            }

            const users = JSON.parse(localStorage.getItem('sc_users')) || [];
            let user = users.find(u => u.mobile === mobile);
            if (!user) {
                user = { mobile, name: 'User', joined: new Date().toISOString() };
                users.push(user);
                localStorage.setItem('sc_users', JSON.stringify(users));
            }
            localStorage.setItem('sc_current_user', JSON.stringify(user));
            localStorage.setItem('sc_current_role', JSON.stringify('customer'));
            store.user = user;
            store.role = 'customer';
        },
        
        logout: () => {
            localStorage.removeItem('sc_current_user');
            localStorage.removeItem('sc_current_role');
            store.user = null;
            store.role = 'customer';
        }
    };

    /**
     * =========================================
     * UTILS & UI COMPONENTS
     * =========================================
     */
    
    const ui = {
        toast: (msg, type = 'success') => {
            const toastEl = document.getElementById('toast');
            const iconEl = document.getElementById('toast-icon');
            const msgEl = document.getElementById('toast-msg');
            
            msgEl.innerText = msg;
            iconEl.className = type === 'success' ? 'fa-solid fa-check-circle text-green-400' : 'fa-solid fa-circle-exclamation text-red-400';
            
            toastEl.classList.remove('opacity-0', 'translate-y-[-20px]');
            setTimeout(() => {
                toastEl.classList.add('opacity-0', 'translate-y-[-20px]');
            }, 3000);
        },
        
        // SMS Simulation
        showSMS: (otp) => {
            const smsEl = document.getElementById('fake-sms');
            document.getElementById('sms-otp-code').innerText = otp;
            smsEl.classList.remove('-translate-y-[200%]');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                smsEl.classList.add('-translate-y-[200%]');
            }, 5000);
        },
        
        spinner: `<i class="fa-solid fa-circle-notch fa-spin"></i>`
    };

    const modals = {
        overlay: document.getElementById('modal-overlay'),
        
        open: (id) => {
            modals.overlay.classList.remove('hidden');
            const modal = document.getElementById(id);
            modal.classList.remove('translate-y-full');
            if(id === 'receipt-modal') {
                modal.classList.remove('hidden', 'pointer-events-none');
                setTimeout(() => {
                    document.getElementById('receipt-card').classList.remove('opacity-0', 'scale-95');
                }, 10);
            }
            if(id === 'confirm-modal') modal.classList.remove('hidden');
        },
        
        closeAll: () => {
            modals.overlay.classList.add('hidden');
            document.querySelectorAll('[id$="-modal"]').forEach(el => {
                if(el.id === 'receipt-modal' || el.id === 'confirm-modal') {
                    el.classList.add('hidden');
                    if(el.id === 'receipt-modal') document.getElementById('receipt-card').classList.add('opacity-0', 'scale-95');
                } else {
                    el.classList.add('translate-y-full');
                }
            });
            // Reset Booking Modal
            setTimeout(() => {
                document.getElementById('booking-step-1').classList.remove('hidden');
                document.getElementById('booking-step-2').classList.add('hidden');
                document.getElementById('btn-find-pros').classList.remove('hidden');
                document.getElementById('booking-spinner').classList.add('hidden');
            }, 300);
            
            // Reset Login Modal Logic
            setTimeout(() => {
                auth.resetLogin();
            }, 300);
        },

        closeReceipt: () => modals.closeAll(),
        closeConfirm: () => modals.closeAll(),
        
        showReceipt: (bookingId) => {
            const b = store.getBookings().find(x => x.id === bookingId);
            if(!b) return;
            document.getElementById('receipt-id').innerText = '#' + b.id;
            document.getElementById('receipt-service').innerText = b.service;
            document.getElementById('receipt-pro').innerText = b.pro;
            document.getElementById('receipt-date').innerText = new Date(b.date).toLocaleDateString('en-IN', { day: 'numeric', month: 'short'});
            document.getElementById('receipt-amount').innerText = '₹' + b.amount;
            modals.open('receipt-modal');
        }
    };

    /**
     * =========================================
     * APP LOGIC & VIEWS
     * =========================================
     */

    const router = {
        init: () => {
            generateInitialData();
            if (store.user) {
                document.getElementById('bottom-nav').classList.remove('hidden');
                router.navigate('home');
            } else {
                router.renderLoginLanding();
            }
            auth.updateHeader();
        },

        navigate: (route) => {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.toggle('text-indigo-600', btn.dataset.target === route);
                btn.classList.toggle('text-gray-400', btn.dataset.target !== route);
            });

            const main = document.getElementById('main-content');
            main.innerHTML = '';
            
            if (store.role === 'admin') {
                if (route === 'home') views.adminDashboard(main);
                else if (route === 'bookings') views.adminAllBookings(main);
                else if (route === 'account') views.account(main);
            } 
            else if (store.role === 'customer') {
                if (route === 'home') views.customerHome(main);
                else if (route === 'bookings') views.customerBookings(main);
                else if (route === 'account') views.account(main);
                else if (route === 'all-categories') views.allCategories(main);
            } else {
                if (route === 'home' || route === 'bookings') views.proDashboard(main);
                else if (route === 'account') views.account(main);
            }
        },
        
        renderLoginLanding: () => {
             const main = document.getElementById('main-content');
             main.innerHTML = `
                <div class="h-full flex flex-col justify-center items-center p-8 text-center bg-white">
                    <div class="w-24 h-24 bg-indigo-100 rounded-3xl flex items-center justify-center mb-6 text-indigo-600 text-4xl animate-slide-up">
                        <i class="fa-solid fa-handshake"></i>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-2 animate-slide-up" style="animation-delay: 0.1s">ServiceConnect</h1>
                    <p class="text-gray-500 mb-10 animate-slide-up" style="animation-delay: 0.2s">Experts for every job, right at your doorstep.</p>
                    <button onclick="modals.open('login-modal')" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold shadow-xl shadow-indigo-200 animate-slide-up" style="animation-delay: 0.3s">
                        Login / Sign Up
                    </button>
                </div>
             `;
             document.getElementById('bottom-nav').classList.add('hidden');
        }
    };

    const views = {
        customerHome: (container) => {
            const categories = [
                { icon: 'fa-broom', name: 'Cleaning' },
                { icon: 'fa-wrench', name: 'Plumbing' },
                { icon: 'fa-bolt', name: 'Electrical' },
                { icon: 'fa-scissors', name: 'Barber' },
                { icon: 'fa-hammer', name: 'Carpenter' },
            ];

            const catsHTML = categories.map(c => `
                <div onclick="booking.start('${c.name}')" class="flex-shrink-0 flex flex-col items-center gap-2 w-[72px] cursor-pointer active:opacity-60 transition-opacity">
                    <div class="w-14 h-14 bg-white rounded-2xl shadow-sm border border-gray-100 flex items-center justify-center text-indigo-600 text-xl">
                        <i class="fa-solid ${c.icon}"></i>
                    </div>
                    <span class="text-[10px] font-medium text-gray-600">${c.name}</span>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="px-5 pt-6 pb-2">
                    <div class="relative">
                        <i class="fa-solid fa-magnifying-glass absolute left-4 top-3.5 text-gray-400"></i>
                        <input type="text" placeholder="Search for 'AC Repair'..." class="w-full pl-10 pr-4 py-3 bg-white rounded-2xl border-none shadow-sm text-sm focus:ring-2 ring-indigo-500 outline-none">
                    </div>
                </div>

                <div class="px-5 py-4">
                    <div class="bg-indigo-600 rounded-3xl p-6 text-white relative overflow-hidden shadow-lg shadow-indigo-200">
                        <div class="absolute -right-6 -top-6 w-24 h-24 bg-white/10 rounded-full"></div>
                        <div class="absolute right-10 bottom-[-20px] w-32 h-32 bg-white/10 rounded-full"></div>
                        <span class="bg-indigo-500 text-[10px] font-bold px-2 py-1 rounded text-white/90">LIMITED OFFER</span>
                        <h2 class="text-xl font-bold mt-2 leading-tight">20% OFF on <br>Home Cleaning</h2>
                        <button onclick="booking.start('Cleaning')" class="mt-4 bg-white text-indigo-700 px-4 py-2 rounded-xl text-xs font-bold shadow-sm active:scale-95 transition-transform">Book Now</button>
                    </div>
                </div>

                <div class="pl-5 pr-2 py-2">
                    <div class="flex justify-between items-center pr-5 mb-4">
                        <h3 class="font-bold text-gray-800">Categories</h3>
                        <button onclick="router.navigate('all-categories')" class="text-xs font-bold text-indigo-600">See All</button>
                    </div>
                    <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2">
                        ${catsHTML}
                    </div>
                </div>

                <div class="px-5 py-2">
                    <h3 class="font-bold text-gray-800 mb-3">Popular Services</h3>
                    <div class="space-y-3">
                         <div onclick="booking.start('Plumbing')" class="bg-white p-4 rounded-2xl shadow-sm border border-gray-50 flex items-center gap-4 active:scale-[0.98] transition-transform">
                            <div class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center text-indigo-600 text-2xl"><i class="fa-solid fa-faucet-drip"></i></div>
                            <div>
                                <h4 class="font-bold text-sm">Leaking Tap Repair</h4>
                                <p class="text-xs text-gray-400">Starts at ₹299</p>
                            </div>
                            <div class="ml-auto bg-gray-50 px-3 py-1 rounded-lg text-xs font-bold text-gray-600">Add</div>
                         </div>
                    </div>
                </div>
            `;
        },

        allCategories: (container) => {
             const allCats = ['Cleaning', 'Plumbing', 'Electrical', 'Painting', 'Carpenter', 'Barber', 'Massage', 'AC Repair', 'Pest Control', 'Gardening'];
             container.innerHTML = `
                <div class="p-5">
                    <h2 class="text-xl font-bold mb-5">All Categories</h2>
                    <div class="grid grid-cols-2 gap-4">
                        ${allCats.map(c => `
                            <div onclick="booking.start('${c}')" class="bg-white p-4 rounded-xl shadow-sm flex flex-col items-center justify-center gap-2 aspect-square active:ring-2 ring-indigo-600 transition-all">
                                <div class="w-10 h-10 bg-gray-50 rounded-full flex items-center justify-center text-indigo-600"><i class="fa-solid fa-layer-group"></i></div>
                                <span class="text-sm font-medium">${c}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
             `;
        },

        customerBookings: (container) => {
            const bookings = store.getBookings();
            let html = '<div class="p-5 space-y-4 pt-8">';
            html += '<h2 class="text-2xl font-bold mb-4">Your Bookings</h2>';
            
            if (bookings.length === 0) {
                html += `<div class="text-center text-gray-400 mt-10"><i class="fa-solid fa-clipboard-list text-4xl mb-3"></i><p>No bookings yet.</p></div>`;
            } else {
                bookings.forEach(b => {
                    const isCompleted = b.status === 'Completed';
                    const statusColor = isCompleted ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700';
                    html += `
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 animate-slide-up">
                            <div class="flex justify-between items-start mb-3">
                                <span class="px-2 py-1 rounded-md text-[10px] font-bold uppercase ${statusColor}">${b.status}</span>
                                <span class="font-mono font-bold text-indigo-600">₹${b.amount}</span>
                            </div>
                            <h3 class="font-bold text-lg">${b.service}</h3>
                            <p class="text-sm text-gray-500 mb-4">with ${b.pro} on ${new Date(b.date).toLocaleDateString()}</p>
                            
                            <div class="flex gap-2">
                                ${isCompleted 
                                    ? `<button onclick="modals.showReceipt('${b.id}')" class="flex-1 py-2 rounded-lg border border-gray-200 text-xs font-bold text-gray-700 hover:bg-gray-50">View Receipt</button>` 
                                    : `<button onclick="booking.confirmCancel('${b.id}')" class="flex-1 py-2 rounded-lg border border-red-100 text-red-500 text-xs font-bold bg-red-50 hover:bg-red-100">Cancel</button>`
                                }
                            </div>
                        </div>
                    `;
                });
            }
            html += '</div>';
            container.innerHTML = html;
        },

        adminDashboard: (container) => {
            const bookings = store.getBookings();
            const pros = store.getPros();
            const requests = store.getProRequests();
            const totalRevenue = bookings.reduce((acc, curr) => acc + (curr.status === 'Completed' ? (parseInt(curr.amount) || 0) : 0), 0);
            
            let requestsHtml = '';
            if(requests.length > 0) {
                requestsHtml = `
                    <div class="bg-white rounded-2xl p-5 mb-8 border border-orange-200 shadow-sm">
                        <div class="flex items-center gap-2 mb-4">
                            <i class="fa-solid fa-circle-exclamation text-orange-500"></i>
                            <h3 class="font-bold text-lg text-orange-900">Approval Requests (${requests.length})</h3>
                        </div>
                        <div class="space-y-3">
                            ${requests.map(r => `
                                <div class="bg-orange-50 p-4 rounded-xl border border-orange-100">
                                    <div class="mb-3 pb-2 border-b border-orange-100">
                                        <p class="text-sm text-gray-800">
                                            <span class="font-bold text-indigo-700">${r.name}</span> wants to join as a <span class="font-bold text-indigo-700">${r.category}</span> Expert.
                                        </p>
                                    </div>
                                    <div class="flex justify-between items-start mb-2">
                                        <div>
                                            <p class="text-xs text-gray-500">+91 ${r.mobile}</p>
                                        </div>
                                    </div>
                                    <div class="text-xs text-gray-600 mb-3 grid grid-cols-2 gap-2">
                                        <span>Rate: ₹${r.rate}/hr</span>
                                        <span class="truncate">Acct: ${r.accountNumber}</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="admin.rejectPro(${r.id})" class="flex-1 bg-white border border-gray-300 py-2 rounded-lg text-xs font-bold text-gray-500 hover:bg-gray-50">Reject</button>
                                        <button onclick="admin.approvePro(${r.id})" class="flex-1 bg-indigo-600 py-2 rounded-lg text-xs font-bold text-white shadow-md hover:bg-indigo-700">Approve</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else {
                requestsHtml = `
                    <div class="bg-white rounded-2xl p-6 mb-8 border border-gray-100 text-center text-gray-400">
                        <i class="fa-solid fa-check-circle text-3xl mb-2 text-gray-200"></i>
                        <p class="text-sm">No Pending Approvals</p>
                    </div>
                `;
            }
            
            let activeProsHtml = '';
            if (pros.length > 0) {
                 activeProsHtml = pros.map(p => `
                    <div class="bg-gray-800 p-4 rounded-xl flex items-center justify-between border border-gray-700">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center font-bold text-gray-400">${p.name.charAt(0)}</div>
                            <div>
                                <h4 class="text-sm font-bold text-white">${p.name}</h4>
                                <p class="text-xs text-gray-400">${p.category} • ₹${p.rate}/hr</p>
                            </div>
                        </div>
                        <button onclick="ui.toast('Verified Pro')" class="text-green-500 text-xs font-bold"><i class="fa-solid fa-check-circle"></i></button>
                    </div>
                `).join('');
            } else {
                activeProsHtml = `<div class="text-gray-500 text-center text-sm py-4">No active professionals yet.</div>`;
            }

            container.innerHTML = `
                <div class="p-5 bg-gray-900 min-h-full text-white pb-20">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">Admin Dashboard</h2>
                        <span class="bg-indigo-600 px-3 py-1 rounded-full text-xs font-bold">SUPER ADMIN</span>
                    </div>

                    ${requestsHtml}

                    <div class="grid grid-cols-2 gap-4 mb-8">
                        <div class="bg-gray-800 p-4 rounded-2xl border border-gray-700">
                            <p class="text-gray-400 text-xs mb-1">Total Revenue</p>
                            <h3 class="text-2xl font-bold font-mono text-green-400">₹${totalRevenue}</h3>
                        </div>
                         <div class="bg-gray-800 p-4 rounded-2xl border border-gray-700">
                            <p class="text-gray-400 text-xs mb-1">Active Pros</p>
                            <h3 class="text-2xl font-bold font-mono text-indigo-400">${pros.length}</h3>
                        </div>
                    </div>

                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg">Platform Pros</h3>
                    </div>
                    
                    <div class="space-y-4 mb-8">
                        ${activeProsHtml}
                    </div>

                    <button onclick="router.navigate('bookings')" class="w-full bg-indigo-600 py-3 rounded-xl font-bold mb-4">View All Bookings</button>
                </div>
            `;
        },

        adminAllBookings: (container) => {
            const bookings = store.getBookings();
             let html = `
                <div class="p-5 min-h-full bg-gray-50">
                    <div class="flex items-center gap-3 mb-6">
                        <button onclick="router.navigate('home')" class="w-8 h-8 bg-white rounded-full flex items-center justify-center shadow-sm"><i class="fa-solid fa-arrow-left"></i></button>
                        <h2 class="text-xl font-bold">All Platform Bookings</h2>
                    </div>
             `;
            
            if (bookings.length > 0) {
                bookings.forEach(b => {
                    const statusColor = b.status === 'Completed' ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700';
                    html += `
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-3">
                            <div class="flex justify-between mb-2">
                                <span class="text-xs font-mono text-gray-400">#${b.id}</span>
                                <span class="text-[10px] font-bold px-2 py-0.5 rounded ${statusColor}">${b.status}</span>
                            </div>
                            <h4 class="font-bold text-sm text-gray-800">${b.service}</h4>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>Pro: ${b.pro}</span>
                                <span>Amt: ₹${b.amount}</span>
                            </div>
                            <div class="mt-2 pt-2 border-t border-gray-50 text-[10px] text-gray-400 truncate">
                                ${b.address}
                            </div>
                        </div>
                    `;
                });
            } else {
                html += `<div class="text-gray-400 text-center py-10">No bookings found on platform.</div>`;
            }
            html += '</div>';
            container.innerHTML = html;
        },

        account: (container) => {
            const isAdmin = store.role === 'admin';
            const isPro = store.role === 'pro';
            let switchText = 'Switch to Pro View';
            let switchIcon = 'fa-briefcase';
            
            if (isPro) {
                switchText = 'Switch to Customer';
                switchIcon = 'fa-user';
            }

            container.innerHTML = `
                <div class="p-5 pt-10">
                    <div class="flex items-center gap-4 mb-8">
                        <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center text-gray-500 text-2xl font-bold relative">
                            ${store.user.name.charAt(0)}
                            ${isAdmin ? '<div class="absolute -bottom-1 -right-1 bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs border-2 border-white"><i class="fa-solid fa-shield"></i></div>' : ''}
                        </div>
                        <div>
                            <h2 class="text-xl font-bold flex items-center gap-2">
                                ${store.user.name} 
                                ${isAdmin ? '<span class="bg-indigo-100 text-indigo-700 text-[10px] px-2 py-0.5 rounded-full uppercase">Admin</span>' : ''}
                            </h2>
                            <p class="text-gray-500 text-sm">+91 ${store.user.mobile}</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                        ${!isAdmin ? `
                        <button onclick="auth.switchRole()" class="w-full text-left p-4 border-b border-gray-50 flex items-center justify-between active:bg-gray-50">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-lg bg-indigo-50 text-indigo-600 flex items-center justify-center"><i class="fa-solid ${switchIcon}"></i></div>
                                <span class="font-medium text-sm text-indigo-700">${switchText}</span>
                            </div>
                            <i class="fa-solid fa-chevron-right text-gray-300 text-xs"></i>
                        </button>
                        ` : ''}
                        
                        <button onclick="ui.toast('Settings coming soon!', 'info')" class="w-full text-left p-4 border-b border-gray-50 flex items-center justify-between active:bg-gray-50">
                             <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-lg bg-gray-50 text-gray-600 flex items-center justify-center"><i class="fa-solid fa-gear"></i></div>
                                <span class="font-medium text-sm">Settings</span>
                            </div>
                            <i class="fa-solid fa-chevron-right text-gray-300 text-xs"></i>
                        </button>
                        <button onclick="auth.logout()" class="w-full text-left p-4 flex items-center justify-between active:bg-gray-50 text-red-500">
                             <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-lg bg-red-50 text-red-500 flex items-center justify-center"><i class="fa-solid fa-arrow-right-from-bracket"></i></div>
                                <span class="font-medium text-sm">Logout</span>
                            </div>
                        </button>
                    </div>
                </div>
            `;
        },

        proDashboard: (container) => {
            // Check status
            const pendingRequest = store.getProRequests().find(r => r.mobile === store.user.mobile);
            const activePro = store.getPros().find(p => p.mobile === store.user.mobile);
            
            // PENDING STATE VIEW
            if (pendingRequest) {
                container.innerHTML = `
                    <div class="p-5 pt-20 h-full flex flex-col items-center justify-center text-center bg-gray-50">
                        <div class="w-24 h-24 bg-orange-100 rounded-full flex items-center justify-center mb-6 animate-pulse">
                            <i class="fa-solid fa-clock text-4xl text-orange-500"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Approval Pending</h2>
                        <p class="text-gray-500 mb-8 max-w-[260px] text-sm leading-relaxed">
                            Hi ${pendingRequest.name}, your application to become a Pro is currently under review by the Admin.
                        </p>
                        
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 w-full mb-6 text-left">
                            <div class="flex items-center gap-3 mb-3 pb-3 border-b border-gray-50">
                                 <div class="w-8 h-8 bg-indigo-50 text-indigo-600 rounded-full flex items-center justify-center"><i class="fa-solid fa-user-check"></i></div>
                                 <span class="font-bold text-sm text-gray-800">Application Details</span>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Category</span>
                                    <span class="font-medium">${pendingRequest.category}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Rate</span>
                                    <span class="font-medium">₹${pendingRequest.rate}/hr</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Status</span>
                                    <span class="font-bold text-orange-500 bg-orange-50 px-2 py-0.5 rounded text-xs">In Review</span>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="auth.switchRole()" class="text-indigo-600 font-bold text-sm hover:underline">Go back to Customer View</button>
                    </div>
                `;
                return;
            }

            // ACTIVE PRO DASHBOARD
            if (activePro) {
                container.innerHTML = `
                    <div class="p-5 pt-8 bg-gray-900 min-h-full text-white">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold">Pro Dashboard</h2>
                            <span class="bg-gray-700 px-3 py-1 rounded-full text-xs">${activePro.category}</span>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-8">
                            <div class="bg-gray-800 p-4 rounded-2xl">
                                <p class="text-gray-400 text-xs mb-1">Earnings</p>
                                <h3 class="text-2xl font-bold font-mono">₹0</h3>
                            </div>
                            <div class="bg-gray-800 p-4 rounded-2xl">
                                <p class="text-gray-400 text-xs mb-1">Jobs Done</p>
                                <h3 class="text-2xl font-bold font-mono">0</h3>
                            </div>
                        </div>

                        <h3 class="font-bold text-lg mb-4">New Leads</h3>
                        <div class="space-y-4">
                           <div class="text-center text-gray-600 py-10 text-sm">No new leads available</div>
                        </div>
                    </div>
                `;
            } else {
                 // Fallback if role is pro but data missing (removed/rejected)
                 container.innerHTML = `<div class="p-10 text-center"><p>Pro profile not found. Please register again.</p><button onclick="auth.switchRole()" class="mt-4 text-indigo-600 font-bold">Go Back</button></div>`;
            }
        }
    };

    const admin = {
        approvePro: (id) => {
            const requests = store.getProRequests();
            const proData = requests.find(r => r.id === id);
            
            if(proData) {
                store.addPro(proData);
                store.removeProRequest(id);
                router.navigate('home'); // Refresh view
                ui.toast(`Approved ${proData.name} as Pro`);
            }
        },
        
        rejectPro: (id) => {
            store.removeProRequest(id);
            router.navigate('home'); // Refresh view
            ui.toast('Request Rejected', 'error');
        }
    };

    const auth = {
        generatedOTP: null,
        currentMobile: null,

        sendOTP: () => {
            const mobileInput = document.getElementById('login-mobile');
            const mobile = mobileInput.value;
            
            if (!mobile || mobile.length < 10) {
                alert('Enter valid 10-digit mobile number');
                return;
            }

            // Generate 4-digit OTP
            const otp = Math.floor(1000 + Math.random() * 9000);
            auth.generatedOTP = otp.toString();
            auth.currentMobile = mobile;

            const btn = document.getElementById('btn-get-otp');
            const originalText = btn.innerText;
            btn.innerHTML = ui.spinner;

            setTimeout(() => {
                // Switch UI Steps
                document.getElementById('login-step-mobile').classList.add('hidden');
                document.getElementById('login-step-otp').classList.remove('hidden');
                document.getElementById('otp-mobile-display').innerText = '+91 ' + mobile;
                
                // Show SMS
                ui.showSMS(otp);
                
                btn.innerHTML = originalText;
            }, 1000);
        },

        verifyAndLogin: () => {
            const userOtp = document.getElementById('otp-input').value;
            const btn = document.getElementById('btn-verify-otp');
            
            if(userOtp !== auth.generatedOTP) {
                ui.toast('Invalid OTP. Please try again.', 'error');
                return;
            }

            btn.innerHTML = ui.spinner;

            setTimeout(() => {
                store.loginUser(auth.currentMobile);
                modals.closeAll();
                document.getElementById('bottom-nav').classList.remove('hidden');
                router.init();
                
                if(store.role === 'admin') {
                    ui.toast(`Welcome Admin, ${store.user.name}`);
                } else {
                    ui.toast(`Welcome back, ${store.user.name}`);
                }
                btn.innerHTML = 'Verify & Login';
            }, 800);
        },

        resetLogin: () => {
            document.getElementById('login-step-mobile').classList.remove('hidden');
            document.getElementById('login-step-otp').classList.add('hidden');
            document.getElementById('otp-input').value = '';
            auth.generatedOTP = null;
        },

        logout: () => {
            store.logout();
            location.reload();
        },

        updateHeader: () => {
            const headerProfile = document.getElementById('header-profile');
            if (store.user) {
                headerProfile.innerHTML = `
                    <div onclick="router.navigate('account')" class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs font-bold cursor-pointer hover:bg-gray-300 transition-colors">
                        ${store.user.name.charAt(0)}
                    </div>`;
            } else {
                headerProfile.innerHTML = '';
            }
        },

        switchRole: () => {
            if (store.role === 'admin') return; 

            if (store.role === 'pro') {
                store.role = 'customer';
                localStorage.setItem('sc_current_role', JSON.stringify('customer'));
                router.navigate('home');
                ui.toast('Switched to Customer View');
            } else {
                const pros = store.getPros();
                const isRegistered = pros.some(p => p.mobile === store.user.mobile || p.name === store.user.name); 
                
                // Check if pending
                const requests = store.getProRequests();
                const isPending = requests.some(r => r.mobile === store.user.mobile);

                if (isRegistered || isPending) { // ALLOW PENDING TO ENTER DASHBOARD
                    store.role = 'pro';
                    localStorage.setItem('sc_current_role', JSON.stringify('pro'));
                    router.navigate('home');
                    ui.toast(isRegistered ? 'Switched to Pro Dashboard' : 'View Application Status');
                } else {
                    modals.open('pro-signup-modal');
                    // Prefill mobile if available
                    setTimeout(() => {
                        const mobileInput = document.querySelector('input[name="mobile"]');
                        if(mobileInput && store.user.mobile) {
                            mobileInput.value = store.user.mobile;
                        }
                    }, 100);
                }
            }
        },

        submitProApplication: (e) => {
            e.preventDefault();
            const form = e.target;
            
            // Extract values correctly
            const mobile = form.querySelector('[name="mobile"]').value;
            const fname = form.querySelector('[name="fname"]').value;
            const lname = form.querySelector('[name="lname"]').value;
            const category = form.querySelector('[name="category"]').value;
            const rate = form.querySelector('[name="rate"]').value;
            const accountNumber = form.querySelector('[name="accountNumber"]').value;

            const data = {
                id: Date.now(),
                name: `${fname} ${lname}`,
                category: category,
                rate: rate,
                accountNumber: accountNumber,
                mobile: mobile,
                rating: 5.0
            };
            
            // Update User Name if "User"
            if(store.user.name === 'User') {
                store.user.name = data.name;
                localStorage.setItem('sc_current_user', JSON.stringify(store.user));
            }

            store.addProRequest(data); // Send to pending
            modals.closeAll();
            ui.toast('Application sent for approval');
        }
    };

    const booking = {
        currentCategory: '',
        
        start: (category) => {
            booking.currentCategory = category;
            document.getElementById('booking-title').innerText = `Book ${category}`;
            document.getElementById('book-date').valueAsDate = new Date();
            modals.open('booking-modal');
        },

        findPros: () => {
            const date = document.getElementById('book-date').value;
            const address = document.getElementById('book-address').value;
            
            if(!date || !address) {
                ui.toast('Please fill all details', 'error');
                return;
            }

            const btn = document.getElementById('btn-find-pros');
            const spinner = document.getElementById('booking-spinner');
            
            btn.classList.add('hidden');
            spinner.classList.remove('hidden');
            spinner.classList.add('flex');

            setTimeout(() => {
                const allPros = store.getPros();
                const relevantPros = allPros.filter(p => p.category === booking.currentCategory || p.category === 'General');
                const displayPros = relevantPros; // Show all relevant

                const listContainer = document.getElementById('pro-list-container');
                if (displayPros.length === 0) {
                     listContainer.innerHTML = `<div class="text-center text-gray-500 py-10">No professionals available in this category yet.</div>`;
                } else {
                    listContainer.innerHTML = displayPros.map(p => `
                        <div onclick="booking.confirmBook(${p.id}, '${p.name}', ${p.rate})" class="flex items-center gap-4 p-3 border rounded-xl hover:border-indigo-600 cursor-pointer transition-colors bg-gray-50">
                            <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center font-bold text-gray-500">${p.name.charAt(0)}</div>
                            <div class="flex-1">
                                <h5 class="font-bold text-sm">${p.name}</h5>
                                <div class="text-xs text-yellow-500"><i class="fa-solid fa-star"></i> ${p.rating}</div>
                            </div>
                            <div class="font-mono font-bold text-indigo-600">₹${p.rate}/hr</div>
                        </div>
                    `).join('');
                }

                spinner.classList.add('hidden');
                spinner.classList.remove('flex');
                document.getElementById('booking-step-1').classList.add('hidden');
                document.getElementById('booking-step-2').classList.remove('hidden');
            }, 1000);
        },

        confirmBook: (proId, proName, rate) => {
            const listContainer = document.getElementById('pro-list-container');
            listContainer.innerHTML = `<div class="py-10 text-center text-indigo-600">${ui.spinner} <span class="ml-2 font-bold">Confirming...</span></div>`;

            setTimeout(() => {
                const newBooking = {
                    id: 'BK-' + Math.floor(1000 + Math.random() * 9000),
                    service: booking.currentCategory,
                    pro: proName,
                    date: document.getElementById('book-date').value,
                    status: 'Upcoming',
                    amount: rate,
                    address: document.getElementById('book-address').value
                };
                
                store.addBooking(newBooking);
                modals.closeAll();
                router.navigate('bookings');
                ui.toast('Booking Confirmed Successfully!');
            }, 1200);
        },

        confirmCancel: (id) => {
            modals.open('confirm-modal');
            const btn = document.getElementById('btn-confirm-cancel');
            
            const newBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(newBtn, btn);
            
            newBtn.addEventListener('click', () => {
                newBtn.innerHTML = ui.spinner;
                setTimeout(() => {
                    store.removeBooking(id);
                    modals.closeConfirm();
                    router.navigate('bookings');
                    ui.toast('Booking Cancelled');
                    newBtn.innerHTML = 'Yes, Cancel'; 
                }, 800);
            });
        }
    };

    window.onload = router.init;

</script>
</body>
</html>